Ext.ns("App");App.rootFolder="";App.arrItems=[];
/*
 * @class App.WebPPT
 * @author Niko Ni (bluepspower@163.com)
 * @version v0.2
 * @create 2010-08-25
 * @update 2010-09-02
 */
App.WebPPT=function(b){Ext.BLANK_IMAGE_URL="images/s.gif";Ext.QuickTips.init();App.WebPPT.superclass.constructor.call(this,{layout:"border",items:[{region:"north",id:"web-ppt-header",height:40,border:false,html:(b.title||"&#160;")},{region:"west",autoScroll:true,id:"moduleTree",xtype:"treepanel",useArrows:true,plugins:[new Ext.ux.TreeOutliner({outlineStyle:[Ext.ux.TreeOutlineFormats.roman,Ext.ux.TreeOutlineFormats.numeric],delimiter:". "})],split:true,width:250,rootVisible:false,root:new Ext.tree.AsyncTreeNode(),loader:new Ext.tree.TreeLoader({url:b.dataUrl}),bbar:[{tooltip:"Expand all folders",iconCls:"tree-expand",handler:function(){Ext.getCmp("moduleTree").expandAll()}},"-",{tooltip:"Collapse all folders",iconCls:"tree-collapse",handler:function(){Ext.getCmp("moduleTree").collapseAll()}}]},{region:"center",id:"content",autoScroll:true,bbar:[{tooltip:"Display options",iconCls:"options",menu:{id:"options-menu",items:[{text:"Increase font size",iconCls:"font-inc",handler:this.changeSize.createDelegate(this,[2]),hideOnClick:false},{text:"Decrease font size",iconCls:"font-dec",handler:this.changeSize.createDelegate(this,[-2]),hideOnClick:false},{text:"Reset font size",iconCls:"font-reset",handler:this.resetSize.createDelegate(this)},"-",{id:"toggle",text:"Maximize slide area",iconCls:"screen-maximize",handler:this.toggleFullScreen}]}},{id:"launchExampleBtn",text:"Launch Example",icon:"images/eye.png",cls:"x-btn-text-icon",disabled:true,handler:this.launchExample,scope:this},"->",{iconCls:"nav-prev",disabled:true,id:"prevBtn",handler:this.navigate.createDelegate(this,[-1])},{iconCls:"nav-next",disabled:true,id:"nextBtn",handler:this.navigate.createDelegate(this,[1])}]}]});var d=Ext.getCmp("moduleTree"),c=d.getSelectionModel(),e=b.callback,a=c.tree;a.mun(a.getTreeEl(),"keydown",c.onKeyDown,c);d.getLoader().on("load",function(){var f=d.root.item(0).attributes;App.rootFolder=f.folder;Ext.getCmp("content").load({url:App.rootFolder+"/"+f.filename,scripts:true});if(typeof e=="function"){App.arrItems=f.children;e()}});c.on("selectionchange",this.onSelectionChange,this,{buffer:100});d.expandAll();Ext.getDoc().on("keydown",function(g){var f=g.getKey();switch(f){case g.DOWN:case g.RIGHT:g.stopEvent();c.selectNext();break;case g.UP:case g.LEFT:g.stopEvent();c.selectPrevious();break}})};Ext.extend(App.WebPPT,Ext.Viewport,{onSelectionChange:function(a,c){var e=Ext.getCmp("content");var d=c.getDepth();if(d===1){if(!c.expanded){c.expand(null,null,function(){a.selectNext()})}else{a.selectNext()}}else{if(d===2){var i=c.parentNode.indexOf(c);var b=c.parentNode.attributes.folder;var f=String.format("{0}/{1}",b,c.attributes.filename);e.load({url:f,scripts:true});var h=c.attributes.exampleUrl?"enable":"disable";Ext.getCmp("launchExampleBtn")[h]();var g=i?"enable":"disable";Ext.getCmp("prevBtn")[g]();Ext.getCmp("nextBtn").enable()}}},navigate:function(b){var a=Ext.getCmp("moduleTree").getSelectionModel();if(b>0){a.selectNext()}else{a.selectPrevious()}},toggleFullScreen:function(){var b=this.fullScreen?"show":"hide";Ext.getCmp("moduleTree")[b]();Ext.getCmp("web-ppt-header")[b]();Ext.getCmp("moduleTree").ownerCt.doLayout();var a=Ext.getCmp("toggle");a.setIconClass(this.fullScreen?"screen-maximize":"screen-restore");a.setText(this.fullScreen?"Maximize slide area":"Restore default layout");this.fullScreen=!this.fullScreen},changeSize:function(c){var b=Ext.util.CSS.getRule("#content",true);var a=parseInt(b.style.getPropertyValue("font-size"));if(!this.fontSize){this.fontSize=a}Ext.util.CSS.updateRule("#content","fontSize",a+c+"px")},resetSize:function(){Ext.util.CSS.updateRule("#content","fontSize",(this.fontSize||14)+"px")},launchExample:function(){var b=Ext.getCmp("moduleTree").getSelectionModel();var a=b.getSelectedNode();window.open(a.attributes.exampleUrl)}});